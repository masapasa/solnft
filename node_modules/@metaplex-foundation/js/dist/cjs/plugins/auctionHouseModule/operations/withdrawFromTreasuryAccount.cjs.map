{"version":3,"file":"withdrawFromTreasuryAccount.cjs","sources":["../../../../../src/plugins/auctionHouseModule/operations/withdrawFromTreasuryAccount.ts"],"sourcesContent":["import { ConfirmOptions } from '@solana/web3.js';\nimport type { Metaplex } from '@/Metaplex';\nimport { TransactionBuilder } from '@/utils';\nimport {\n  createWithdrawFromTreasuryInstruction,\n  WithdrawFromTreasuryInstructionAccounts,\n} from '@metaplex-foundation/mpl-auction-house';\nimport {\n  useOperation,\n  Operation,\n  OperationHandler,\n  Signer,\n  SolAmount,\n  SplTokenAmount,\n} from '@/types';\nimport { SendAndConfirmTransactionResponse } from '../../rpcModule';\nimport { AuctionHouse } from '../models';\nimport { findAuctionHouseTreasuryPda } from '../pdas';\n\n// -----------------\n// Operation\n// -----------------\n\nconst Key = 'WithdrawFromTreasuryAccountOperation' as const;\n\n/**\n * Transfers funds from Auction House Treasury Wallet to the Treasury Withdrawal Destination Wallet set on an Auction House creation.\n * By default Treasury Withdrawal Destination Wallet is set to `metaplex.identity()`.\n *\n * ```ts\n * await metaplex\n *   .auctionHouse()\n *   .withdrawFromTreasuryAccount({ auctionHouse, amount })\n *   .run();\n * ```\n *\n * @group Operations\n * @category Constructors\n */\nexport const withdrawFromTreasuryAccountOperation =\n  useOperation<WithdrawFromTreasuryAccountOperation>(Key);\n\n/**\n * @group Operations\n * @category Types\n */\nexport type WithdrawFromTreasuryAccountOperation = Operation<\n  typeof Key,\n  WithdrawFromTreasuryAccountInput,\n  WithdrawFromTreasuryAccountOutput\n>;\n\n/**\n * @group Operations\n * @category Inputs\n */\n\nexport type WithdrawFromTreasuryAccountInput = {\n  /**\n   * The Auction House from which to transfer funds from the treasury wallet to the treasury withdrawal destination wallet.\n   * `treasuryWithdrawalDestinationAddress` is set on Auction House creation, but you can also change it via the `update` operation.\n   */\n  auctionHouse: Pick<\n    AuctionHouse,\n    | 'treasuryMint'\n    | 'authorityAddress'\n    | 'treasuryWithdrawalDestinationAddress'\n    | 'address'\n  >;\n\n  /**\n   * The Auction House authority.\n   *\n   * @defaultValue `metaplex.identity()`\n   */\n  authority?: Signer;\n\n  /**\n   * The Signer paying for the transaction fee.\n   *\n   * @defaultValue `metaplex.identity()`\n   */\n  payer?: Signer;\n\n  /**\n   * Amount of funds to withdraw.\n   * This can either be in SOL or in the SPL token used by the Auction House as a currency.\n   */\n  amount: SolAmount | SplTokenAmount;\n\n  /** A set of options to configure how the transaction is sent and confirmed. */\n  confirmOptions?: ConfirmOptions;\n};\n\n/**\n * @group Operations\n * @category Outputs\n */\nexport type WithdrawFromTreasuryAccountOutput = {\n  /** The blockchain response from sending and confirming the transaction. */\n  response: SendAndConfirmTransactionResponse;\n};\n\n/**\n * @group Operations\n * @category Handlers\n */\nexport const withdrawFromTreasuryAccountOperationHandler: OperationHandler<WithdrawFromTreasuryAccountOperation> =\n  {\n    handle: async (\n      operation: WithdrawFromTreasuryAccountOperation,\n      metaplex: Metaplex\n    ) =>\n      withdrawFromTreasuryAccountBuilder(\n        metaplex,\n        operation.input\n      ).sendAndConfirm(metaplex, operation.input.confirmOptions),\n  };\n\n// -----------------\n// Builder\n// -----------------\n\n/**\n * @group Transaction Builders\n * @category Inputs\n */\nexport type WithdrawFromTreasuryAccountBuilderParams = Omit<\n  WithdrawFromTreasuryAccountInput,\n  'confirmOptions'\n> & {\n  instructionKey?: string;\n};\n\n/**\n * @group Transaction Builders\n * @category Contexts\n */\nexport type WithdrawFromTreasuryAccountBuilderContext = Omit<\n  WithdrawFromTreasuryAccountOutput,\n  'response'\n>;\n\n/**\n * Transfers funds from Auction House Treasury Wallet to the Treasury Withdrawal Destination Wallet set on an Auction House creation.\n * By default Treasury Withdrawal Destination Wallet is set to `metaplex.identity()`.\n *\n * ```ts\n * const transactionBuilder = metaplex\n *   .auctionHouse()\n *   .builders()\n *   .withdrawFromTreasuryAccount({ auctionHouse, amount });\n * ```\n *\n * @group Transaction Builders\n * @category Constructors\n */\nexport const withdrawFromTreasuryAccountBuilder = (\n  metaplex: Metaplex,\n  params: WithdrawFromTreasuryAccountBuilderParams\n): TransactionBuilder<WithdrawFromTreasuryAccountBuilderContext> => {\n  // Data.\n  const {\n    auctionHouse,\n    amount,\n    instructionKey,\n    payer = metaplex.identity(),\n    authority = metaplex.identity(),\n  } = params;\n\n  // Accounts.\n  const auctionHouseTreasury = findAuctionHouseTreasuryPda(\n    auctionHouse.address\n  );\n\n  const accounts: WithdrawFromTreasuryInstructionAccounts = {\n    treasuryMint: auctionHouse.treasuryMint.address,\n    authority: auctionHouse.authorityAddress,\n    treasuryWithdrawalDestination:\n      auctionHouse.treasuryWithdrawalDestinationAddress,\n    auctionHouseTreasury: auctionHouseTreasury,\n    auctionHouse: auctionHouse.address,\n  };\n\n  // Args.\n  const args = {\n    amount: amount.basisPoints,\n  };\n\n  // Withdraw From Treasury Instruction.\n  const withdrawFromTreasuryInstruction = createWithdrawFromTreasuryInstruction(\n    accounts,\n    args\n  );\n\n  // Signers.\n  return (\n    TransactionBuilder.make()\n      .setFeePayer(payer)\n      // Withdraw From Treasury.\n      .add({\n        instruction: withdrawFromTreasuryInstruction,\n        signers: [authority],\n        key: instructionKey ?? 'withdrawFromTreasuryAccount',\n      })\n  );\n};\n"],"names":["Key","withdrawFromTreasuryAccountOperation","useOperation","withdrawFromTreasuryAccountOperationHandler","handle","operation","metaplex","withdrawFromTreasuryAccountBuilder","input","sendAndConfirm","confirmOptions","params","auctionHouse","amount","instructionKey","payer","identity","authority","auctionHouseTreasury","findAuctionHouseTreasuryPda","address","accounts","treasuryMint","authorityAddress","treasuryWithdrawalDestination","treasuryWithdrawalDestinationAddress","args","basisPoints","withdrawFromTreasuryInstruction","createWithdrawFromTreasuryInstruction","TransactionBuilder","make","setFeePayer","add","instruction","signers","key"],"mappings":";;;;;;;;;AAoBA;AACA;;AAEA,MAAMA,GAAG,GAAG,sCAAZ,CAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;MACaC,oCAAoC,GAC/CC,sBAAY,CAAuCF,GAAvC,EADP;AAGP;AACA;AACA;AACA;;AA0DA;AACA;AACA;AACA;AACO,MAAMG,2CAAmG,GAC9G;EACEC,MAAM,EAAE,OACNC,SADM,EAENC,QAFM,KAINC,kCAAkC,CAChCD,QADgC,EAEhCD,SAAS,CAACG,KAFsB,CAAlC,CAGEC,cAHF,CAGiBH,QAHjB,EAG2BD,SAAS,CAACG,KAAV,CAAgBE,cAH3C,CAAA;AALJ;AAYF;AACA;;AAEA;AACA;AACA;AACA;;AAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACaH,kCAAkC,GAAG,CAChDD,QADgD,EAEhDK,MAFgD,KAGkB;AAClE;EACA,MAAM;IACJC,YADI;IAEJC,MAFI;IAGJC,cAHI;AAIJC,IAAAA,KAAK,GAAGT,QAAQ,CAACU,QAAT,EAJJ;IAKJC,SAAS,GAAGX,QAAQ,CAACU,QAAT,EAAA;GACVL,GAAAA,MANJ,CAFkE;;AAWlE,EAAA,MAAMO,oBAAoB,GAAGC,gCAA2B,CACtDP,YAAY,CAACQ,OADyC,CAAxD,CAAA;AAIA,EAAA,MAAMC,QAAiD,GAAG;AACxDC,IAAAA,YAAY,EAAEV,YAAY,CAACU,YAAb,CAA0BF,OADgB;IAExDH,SAAS,EAAEL,YAAY,CAACW,gBAFgC;IAGxDC,6BAA6B,EAC3BZ,YAAY,CAACa,oCAJyC;AAKxDP,IAAAA,oBAAoB,EAAEA,oBALkC;IAMxDN,YAAY,EAAEA,YAAY,CAACQ,OAAAA;AAN6B,GAA1D,CAfkE;;AAyBlE,EAAA,MAAMM,IAAI,GAAG;IACXb,MAAM,EAAEA,MAAM,CAACc,WAAAA;AADJ,GAAb,CAzBkE;;EA8BlE,MAAMC,+BAA+B,GAAGC,qDAAqC,CAC3ER,QAD2E,EAE3EK,IAF2E,CAA7E,CA9BkE;;AAoClE,EAAA,OACEI,qCAAkB,CAACC,IAAnB,GACGC,WADH,CACejB,KADf,CAEE;AAFF,GAGGkB,GAHH,CAGO;AACHC,IAAAA,WAAW,EAAEN,+BADV;IAEHO,OAAO,EAAE,CAAClB,SAAD,CAFN;AAGHmB,IAAAA,GAAG,EAAEtB,cAAF,KAAA,IAAA,IAAEA,cAAF,KAAA,KAAA,CAAA,GAAEA,cAAF,GAAoB,6BAAA;AAHpB,GAHP,CADF,CAAA;AAUD;;;;;;"}