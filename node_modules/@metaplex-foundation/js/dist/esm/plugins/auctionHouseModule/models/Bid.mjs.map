{"version":3,"file":"Bid.mjs","sources":["../../../../../src/plugins/auctionHouseModule/models/Bid.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport {\n  amount,\n  BigNumber,\n  DateTime,\n  lamports,\n  Pda,\n  SolAmount,\n  SplTokenAmount,\n  toBigNumber,\n  toDateTime,\n  toOptionDateTime,\n} from '@/types';\nimport { BidReceiptAccount } from '../accounts';\nimport { assert, Option } from '@/utils';\nimport { AuctionHouse } from './AuctionHouse';\nimport { Nft, NftWithToken, Sft, SftWithToken } from '../../nftModule';\n\n/** @group Models */\nexport type Bid = Readonly<\n  {\n    /** A model identifier to distinguish models in the SDK. */\n    model: 'bid';\n\n    /**\n     * Whether or not the asset was loaded.\n     * When this is `false`, it means the Bid includes asset model.\n     */\n    lazy: false;\n\n    /** A model of the Auction House related to this bid. */\n    auctionHouse: AuctionHouse;\n\n    /** The address of the buyer's trade state account. */\n    tradeStateAddress: Pda;\n\n    /** The address of the buyer's wallet. */\n    buyerAddress: PublicKey;\n\n    /**\n     * The address of the bookkeeper account.\n     * It is responsible for signing a Bid Receipt Print.\n     */\n    bookkeeperAddress: Option<PublicKey>;\n\n    /**\n     * The address of the bid receipt account.\n     * This is the account that stores information about this bid.\n     * The Bid model is built on top of this account.\n     */\n    receiptAddress: Option<Pda>;\n\n    /**\n     * The address of the purchase receipt account.\n     * This is the account that stores information about the purchase related to this bid.\n     *\n     * ```ts\n     * const transactionBuilder = metaplex\n     *   .auctionHouse()\n     *   .builders()\n     *   .findPurchaseByReceipt({ auctionHouse, receiptAddress: purchaseReceiptAddress });\n     * ```\n     */\n    purchaseReceiptAddress: Option<PublicKey>;\n\n    /** The buyer's price. */\n    price: SolAmount | SplTokenAmount;\n\n    /** The number of tokens bid is for. */\n    tokens: SplTokenAmount;\n\n    /** The date of creation. */\n    createdAt: DateTime;\n\n    /** The date of cancellation. */\n    canceledAt: Option<DateTime>;\n  } & (\n    | {\n        /** The bid is not public, which means that it was created according to the listing. */\n        isPublic: false;\n\n        /** The Nft or Sft with the associated token account. */\n        asset: SftWithToken | NftWithToken;\n      }\n    | {\n        /**\n         * The bid is public.\n         * This means that a bid can stay active beyond the end of an auction\n         * and be resolved if it meets the criteria for subsequent auctions of that token.\n         */\n        isPublic: true;\n\n        /** The Nft or Sft related to the Bid. */\n        asset: Sft | Nft;\n      }\n  )\n>;\n\n/** @group Model Helpers */\nexport const isBid = (value: any): value is Bid =>\n  typeof value === 'object' && value.model === 'bid' && !value.lazy;\n\n/** @group Model Helpers */\nexport function assertBid(value: any): asserts value is Bid {\n  assert(isBid(value), `Expected Bid type`);\n}\n\n/** @group Model Helpers */\nexport const toBid = (\n  account: BidReceiptAccount,\n  auctionHouse: AuctionHouse,\n  asset: Nft | Sft | NftWithToken | SftWithToken\n): Bid => {\n  const lazyBid = toLazyBid(account, auctionHouse);\n\n  return {\n    ...lazyBid,\n    model: 'bid',\n    lazy: false,\n    ...('token' in asset\n      ? {\n          asset,\n          tokens: amount(lazyBid.tokens, asset.mint.currency),\n          isPublic: false,\n        }\n      : {\n          asset,\n          tokens: amount(lazyBid.tokens, asset.mint.currency),\n          isPublic: true,\n        }),\n  };\n};\n\nexport type LazyBid = Omit<Bid, 'lazy' | 'asset' | 'tokens'> &\n  Readonly<{\n    lazy: true;\n    metadataAddress: PublicKey;\n    tokenAddress: Option<PublicKey>;\n    tokens: BigNumber;\n  }>;\n\n/** @group Model Helpers */\nexport const isLazyBid = (value: any): value is LazyBid =>\n  typeof value === 'object' && value.model === 'bid' && value.lazy;\n\n/** @group Model Helpers */\nexport function assertLazyBid(value: any): asserts value is LazyBid {\n  assert(isLazyBid(value), `Expected LazyBid type`);\n}\n\n/** @group Model Helpers */\nexport const toLazyBid = (\n  account: BidReceiptAccount,\n  auctionHouse: AuctionHouse\n): LazyBid => {\n  return {\n    model: 'bid',\n    lazy: true,\n    auctionHouse,\n    tradeStateAddress: new Pda(\n      account.data.tradeState,\n      account.data.tradeStateBump\n    ),\n    bookkeeperAddress: account.data.bookkeeper,\n    buyerAddress: account.data.buyer,\n    metadataAddress: account.data.metadata,\n    tokenAddress: account.data.tokenAccount,\n    receiptAddress: new Pda(account.publicKey, account.data.bump),\n    purchaseReceiptAddress: account.data.purchaseReceipt,\n    isPublic: Boolean(account.data.tokenAccount),\n\n    // Data.\n    price: auctionHouse.isNative\n      ? lamports(account.data.price)\n      : amount(account.data.price, auctionHouse.treasuryMint.currency),\n    tokens: toBigNumber(account.data.tokenSize),\n    createdAt: toDateTime(account.data.createdAt),\n    canceledAt: toOptionDateTime(account.data.canceledAt),\n  };\n};\n"],"names":["isBid","value","model","lazy","assertBid","assert","toBid","account","auctionHouse","asset","lazyBid","toLazyBid","tokens","amount","mint","currency","isPublic","isLazyBid","assertLazyBid","tradeStateAddress","Pda","data","tradeState","tradeStateBump","bookkeeperAddress","bookkeeper","buyerAddress","buyer","metadataAddress","metadata","tokenAddress","tokenAccount","receiptAddress","publicKey","bump","purchaseReceiptAddress","purchaseReceipt","Boolean","price","isNative","lamports","treasuryMint","toBigNumber","tokenSize","createdAt","toDateTime","canceledAt","toOptionDateTime"],"mappings":"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"}